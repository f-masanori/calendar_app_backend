# カレンダーアプリ　backend

サマーインターンを終えて、以前作成したカレンダーアプリのバックエンド(apiサーバー)に修正したい部分がたくさん見つかったので、学習を兼ねて改善したいと思ってはじめました。

修正前→(https://github.com/f-masanori/calendar_app)

### 目的

学習をメインの目的として開発し始めました。

### 技術選定

学習のため、これまで自分が使ったことがなかった言語やツールを使用して開発しました。

- 言語
  - golang
    - 理由
      - 静的型付き言語(好み、読みやすい)
      - 標準ライブラリだけでサーバーを構築できるので、学習しやすそう
- 開発環境
  - Docker
    - 理由
      - ローカル環境を汚さない
      - デプロイが簡単になる
- 設計
  - クリーンアーキテクチャライクなもの
    - 理由
      - 挑戦してみたかった

### セットアップ

1. ソースコードのルートディレクトリにあるMakefile内の`GOOGLE_APPLICATION_CREDENTIALS=$(HOME)/.config/gcloud/calendar_service_account.json`を自身のfirebase プロジェクトのjsonファイルのパスに書き換える

2. `make dcu`で実行。(docker-comopose コマンドで立ち上げると、設定が読み込めずエラーになります。)

3. `make mysql/init`でこのアプリで使うDB作成
4. `make flyway/migrate`でマイグレーション実行

### 前回からの改善点[改善予定のものも含む]

1. reflexを導入して開発の効率を上げた
2. サマーインターン先でのMakefile文化を真似して、MakefileにDB接続先情報やfirebase設定情報を書いた（設定情報がプロジェクトのルートに来るので読みやすくなった）
3. ミドルウェアをalice(ライブラリ)を使ってまとめて、可読性アップ
4. プレゼンテーター機能をinterface層に記述していたのを、infrastructure層に移動して、責務の分散する(これによって拡張性が増加)[改善予定]
5. マイグレーション機能を一つのコンテナとして独立させる。[改善予定]（前回はカレンダーアプリの中でマイグレーションするようにしていたが、毎回コンテナの中に入って実行するのが面倒だった。）
6. Rest API化する。[改善中]（規則を作ることで可読性アップ）
7. テストコードの書き方を練習するためテストを増やす。[改善予定]（現在一個しか書いてない）

### 困っている・悩んでいること
1. エラーハンドリングの実装(どこをpanicにして、どこをlogに残すべきかとか。そもそもエラーハンドリングの知識がたりてない)
2. トランザクション処理をservicesで実装すべきなのか。（servicesにトランザクションを書いたらservicesがDBに依存するのではないか？）

### 一番ハマった部分
CORSに対応する実装部分

### テスト

- servicesのテスト実行

`make app/user_service_TestGetAllSuccess_test`

`make app/user_service_TestStoreNewUserSuccess_test`



###  クリーンアーキテクチャを使用したことについて

使ってみた主な目的は学習のためです。まだまだ、知識と経験不足でクリーンアーキテクチャと呼んでいい設計になっているのかは不安ですが、自分なりに責務を分離して実装しました。

また、初めて設計を意識して開発したのが、これが初めてだったので、責務を考えるきっかけになったという意味でとても、学びになりました。

今回の実装で

- 責務を明確に分けることができ、コードの可読性と、保守性が上がる
- アプリケーションのコアの部分である、Entitiesとuse casesをメインに考える（DBとかの永続化はサブというイメージ）

といったクリーンアーキテクチャのメリット・特徴を理解することができたと思います。

これからは書籍などを読んでさらに深く学ぼうと思っています。